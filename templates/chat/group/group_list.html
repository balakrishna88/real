<!-- group_list.html -->
{% extends 'base.html' %}
{% load static %}
{% block title %}Group List{% endblock %}

{% block content %}
<!-- Create Group Button -->
<div class="m-8">
    <a href="{% url 'create_group' %}" class="bg-green-600 text-white px-6 py-3 rounded-md hover:bg-green-700 transition-colors font-semibold">
        Create Group
    </a>
</div>

<!-- Public Groups Section -->
<div class="m-4 bg-white dark:bg-gray-900 text-gray-900 dark:text-white p-4 rounded-lg shadow">
    <h2 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-4 text-center">Public Groups</h2>
    
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
        {% if public_groups %}
            {% for group in public_groups %}
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-300 dark:border-gray-700 overflow-hidden transition-transform duration-300 hover:scale-105 hover:shadow-lg w-56 mx-auto">
                    <div class="h-24 bg-gray-100 dark:bg-gray-700 flex items-center justify-center border-b">
                        <img src="{% if group.logo %}{{ group.logo.url }}{% else %}{% static 'images/group_default.png' %}{% endif %}" 
                             alt="{{ group.name }} logo" class="w-full h-full object-cover rounded-t-lg">
                    </div>
                    <div class="p-2">
                        <h3 class="text-sm font-semibold text-gray-800 dark:text-gray-100 truncate">{{ group.name }}</h3>
                        <p class="text-xs text-gray-600 dark:text-gray-300 mt-1 truncate">
                            {{ group.description|default:"No description available." }}
                        </p>
                        <div class="flex justify-between text-xs text-gray-700 dark:text-gray-300 mt-2">
                            <span><strong>Type:</strong> {{ group.get_group_type_display }}</span>
                            <span><strong>ðŸ‘¥</strong> {{ group.participants.count }}</span>
                        </div>
                        <div class="mt-3">
                            {% if request.user.is_authenticated %}
                                {% if request.user in group.participants.all %}
                                    <a href="{% url 'group_detail' group.name %}" 
                                       class="block bg-blue-600 dark:bg-blue-500 text-white text-center text-xs px-2 py-1 rounded-md hover:bg-blue-700 dark:hover:bg-blue-400 transition">
                                        Chat
                                    </a>
                                {% else %}
                                    <form action="{% url 'group_join' group.name %}" method="post">
                                        {% csrf_token %}
                                        <button type="submit" 
                                                class="w-full bg-green-600 dark:bg-green-500 text-white text-xs px-2 py-1 rounded-md hover:bg-green-700 dark:hover:bg-green-400 transition"
                                                onclick="return confirm('Are you sure you want to join {{ group.name }}?')">
                                            Join
                                        </button>
                                    </form>
                                {% endif %}
                            {% else %}
                                <a href="{% url 'login' %}" 
                                   class="block bg-gray-600 dark:bg-gray-500 text-white text-xs text-center px-2 py-1 rounded-md hover:bg-gray-700 dark:hover:bg-gray-400 transition">
                                    Sign In
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="col-span-full text-center text-gray-600 dark:text-gray-400 py-4">
                <p>No public groups available.</p>
            </div>
        {% endif %}
    </div>
</div>

<!-- Private Groups Section -->
<div class="m-4 bg-white dark:bg-gray-900 text-gray-900 dark:text-white p-4 rounded-lg shadow">
    <h2 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-4 text-center">Private Groups</h2>
    
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
        {% if private_groups_data %}
            {% for item in private_groups_data %}
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 overflow-hidden transition-transform duration-300 hover:scale-105 hover:shadow-lg w-56 mx-auto">
                    <div class="h-24 bg-gray-100 dark:bg-gray-700 flex items-center justify-center border-b">
                        {% if item.group.logo %}
                            <img src="{{ item.group.logo.url }}" alt="{{ item.group.name }} logo" class="w-full h-full object-cover rounded-t-lg">
                        {% else %}
                            <span class="text-gray-500 dark:text-gray-400">No logo</span>
                        {% endif %}
                    </div>
                    <div class="p-2">
                        <h3 class="text-sm font-semibold text-gray-800 dark:text-gray-200 truncate">{{ item.group.name }}</h3>
                        <p class="text-xs text-gray-600 dark:text-gray-400 mt-1 truncate">{{ item.group.description|default:"No description available." }}</p>
                        <div class="flex justify-between text-xs text-gray-700 dark:text-gray-300 mt-2">
                            <span><strong>Type:</strong> {{ item.group.get_group_type_display }}</span>
                            <span><strong>ðŸ‘¥</strong> {{ item.group.participants.count }}</span>
                        </div>
                        <div class="mt-2 text-xs">
                            <span class="font-semibold">Status:</span>
                            {% if item.group.status == 'published' %}
                                <span class="text-green-600 dark:text-green-400">Live</span>
                            {% elif item.group.status == 'draft' %}
                                <span class="text-red-600 dark:text-red-400">Not Live</span>
                            {% elif item.group.status == 'frozen' %}
                                <span class="text-yellow-600 dark:text-yellow-400">Frozen</span>
                            {% endif %}
                        </div>
                        <div class="mt-3">
                            {% if not user_authenticated %}
                                <a href="{% url 'login' %}" 
                                   class="block bg-gray-600 dark:bg-gray-700 text-white text-xs text-center px-2 py-1 rounded-md hover:bg-gray-700 dark:hover:bg-gray-800 transition">
                                    Sign In
                                </a>
                            {% elif item.is_participant %}
                                <a href="{% url 'group_detail' item.group.name %}" 
                                   class="block bg-blue-600 dark:bg-blue-500 text-white text-xs text-center px-2 py-1 rounded-md hover:bg-blue-700 dark:hover:bg-blue-600 transition">
                                    Chat
                                </a>
                            {% elif item.has_pending_request %}
                                <button disabled 
                                        class="block w-full bg-gray-400 dark:bg-gray-500 text-white text-xs text-center px-2 py-1 rounded-md cursor-not-allowed">
                                    Pending
                                </button>
                            {% else %}
                                <form method="post" action="{% url 'request_to_join_group' item.group.id %}">
                                    {% csrf_token %}
                                    <button type="submit" 
                                            class="w-full bg-green-600 dark:bg-green-500 text-white text-xs text-center px-2 py-1 rounded-md hover:bg-green-700 dark:hover:bg-green-600 transition"
                                            onclick="return confirm('Request to join {{ item.group.name }}?')">
                                        Request
                                    </button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="col-span-full text-center text-gray-600 dark:text-gray-400 py-4">
                <p>No private groups available.</p>
            </div>
        {% endif %}
    </div>
</div>


{% endblock %}